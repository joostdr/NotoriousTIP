<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"/>

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"/>

    <!-- Latest compiled and minified JavaScript -->
    <script src="http://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet"/>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <link href="../static/css/styles.css"
          th:href="@{/css/main.css}" rel="stylesheet"/>
</head>
<body>
<div class="container">

    <div class="header clearfix">
        <nav>
            <ul class="nav nav-pills pull-right">
                <form th:action="@{/logout}" method="post">
                    <input type="submit" class="btn btn-danger" value="Sign Out"/>
                </form>
            </ul>
        </nav>
        <h3 class="text-muted">Control center</h3>
    </div>
    <div class="jumbotron">
        <h1>Control your device</h1>
        <p><small>(Having problems? Check the FAQ below)</small></p>
        <div class="row" id="onOffButtonRow">
            <div class="col-md-12 pull-center"><input type="checkbox" id="ayy" data-toggle="toggle"
                                                      data-width="100"/></div>
        </div>
        <div class="row">
            <div class="col-md-12 pull-center"><p id="ajaxResult">Device status: OFF</p></div>
        </div>
        <div class="row">
            <div class="col-md-12 pull-center" id="loadingDiv">
                <img src="https://s17.postimg.org/hftk82v8f/ajax_loader.gif"/>
            </div>
        </div>
        <div class="col-md-12 pull-center" id="ajaxError"></div>
        <!---->
    </div>
</div>
</body>

<script>

    /*$(document).ajaxStart(function() {
     $("#loading").show();
     console.log("SHOW");
     });

     $(document).ajaxStop(function() {
     $("#loading").hide();
     console.log("HIDE");
     });*/

    $(function () { //function which handles the on/off button
        $('#ayy').change(function () {
            if ($(this).prop('checked')) { //if ON > do POST request to Java controller which makes HTTP calls to the vibrator
                $("#loadingDiv").show();
                $('#ayy').bootstrapToggle('disable')
                $.ajax({
                    url: "api/on",
                }).done(function (data) {
                    $('#ayy').bootstrapToggle('enable')
                    $("#loadingDiv").hide();
                    $("#ajaxError").text(data);
                    switch (data) {
                        case "200":
                            $("#ajaxResult").text("Device status: ON");
                            break;
                        case "500":
                            $("#ajaxError").text("Something went wrong");
                            $('#ayy').bootstrapToggle('toggle');
                            break;
                    }   //return response code
                });
            }
            else { //if OFF > do same as above
                $("#loadingDiv").show();
                $('#ayy').bootstrapToggle('disable')
                $.ajax({
                    url: "api/off",
                }).done(function (data) {
                    $('#ayy').bootstrapToggle('enable')
                    $("#loadingDiv").hide();//alert(data);
                    $("#ajaxError").text(data);
                    switch (data) {
                        case "200":
                            $("#ajaxResult").text("Device status: OFF");
                            break;
                        case "500":
                            $("#ajaxError").text("Something went wrong");
                            break;
                    }
                });
            }
        })
    })
</script>
</html>